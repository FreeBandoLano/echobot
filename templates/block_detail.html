
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block {{ block.block_code }} • Radio Synopsis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/theme.css">
    <style>
        .detail-meta { display:flex; flex-wrap:wrap; gap:.75rem; font-size:.7rem; color:var(--text-tertiary); margin: .25rem 0 1.25rem; }
        .pill { background: var(--color-panel-alt); padding:.35rem .7rem; border-radius: var(--radius-pill); border:1px solid var(--color-border); }
        .sub-heading { font-size:.8rem; text-transform:uppercase; letter-spacing:.12em; color:var(--text-tertiary); margin:1.5rem 0 .6rem; font-weight:600; }
        .quote { border-left:3px solid var(--color-gold); padding:.4rem .85rem; margin:.6rem 0; background: var(--color-panel-alt); border-radius: var(--radius-sm); font-size:.8rem; }
        .quote footer { font-size:.65rem; letter-spacing:.05em; margin-top:.25rem; color:var(--text-tertiary); }
        .entity-badge { display:inline-block; background: var(--color-overlay); border:1px solid var(--color-border); padding:.35rem .6rem; border-radius: var(--radius-pill); font-size:.6rem; letter-spacing:.08em; margin:0 .4rem .4rem 0; text-transform:uppercase; }
        .transcript-seg { margin:0 0 .75rem; padding:.55rem .75rem .6rem; background: var(--color-panel-alt); border:1px solid var(--color-border); border-radius: var(--radius-sm); font-size:.75rem; line-height:1.4; }
        .transcript-seg small { display:block; font-size:.6rem; letter-spacing:.1em; color:var(--text-tertiary); margin-bottom:.25rem; }
        .back-links { display:flex; gap:.5rem; flex-wrap:wrap; margin:0 0 1.2rem; }
        .back-links a { text-decoration:none; font-size:.65rem; letter-spacing:.1em; padding:.5rem .85rem; border-radius: var(--radius-pill); background: var(--grad-active); color: var(--text-inverse); font-weight:600; }
        .summary-text { font-size:.85rem; line-height:1.5; color:var(--text-secondary); white-space:pre-wrap; }
    .emergent-grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); margin:.75rem 0 1.5rem; }
    .emergent-card { background:var(--color-panel-alt); border:1px solid var(--color-border); border-radius:var(--radius-md); padding:.75rem .85rem .9rem; position:relative; }
    .emergent-card h4 { font-size:.7rem; letter-spacing:.12em; margin:0 0 .4rem; text-transform:uppercase; color:var(--text-tertiary); font-weight:600; }
    .theme-title { font-size:.78rem; font-weight:600; color:var(--text-primary); margin:0 0 .35rem; }
    .theme-bullets { list-style:disc; padding-left:1.1rem; margin:0 0 .35rem; }
    .theme-bullets li { font-size:.68rem; line-height:1.35; margin:.25rem 0; color:var(--text-secondary); }
    .mini-badge { display:inline-block; background:var(--color-overlay); border:1px solid var(--color-border); padding:.2rem .45rem .25rem; border-radius:var(--radius-pill); font-size:.55rem; letter-spacing:.08em; font-weight:500; color:var(--text-tertiary); }
    .positions-list, .actions-list { list-style:none; padding:0; margin:0; }
    .positions-list li, .actions-list li { font-size:.65rem; line-height:1.3; padding:.4rem .5rem .45rem; background:var(--color-panel-alt); border:1px solid var(--color-border); border-radius:var(--radius-sm); margin:0 0 .45rem; }
    .raw-json-wrap { display:none; margin-top:.75rem; }
    .toggle-raw { appearance:none; border:none; background:var(--grad-active); color:var(--text-inverse); font-size:.55rem; letter-spacing:.12em; font-weight:600; padding:.45rem .7rem .5rem; border-radius:var(--radius-pill); cursor:pointer; }
    pre.raw-json { max-height:300px; overflow:auto; font-size:.6rem; line-height:1.2; background:var(--color-panel-alt); border:1px solid var(--color-border); padding:.6rem .7rem; border-radius:var(--radius-sm); }
    </style>
</head>
<body>
    <header class="app-header">
        <a href="/" class="app-logo"><i class="bi bi-broadcast"></i> <span>Radio Synopsis</span></a>
        <nav class="app-nav">
            <a href="/" class="app-nav__link">Today</a>
            <a href="/archive" class="app-nav__link">Archive</a>
            <a href="/analytics" class="app-nav__link">Analytics</a>
        </nav>
    </header>
    <main>
        <section class="panel" data-active="true">
            <div class="back-links">
                <a href="/">DASHBOARD</a>
                <a href="/archive">ARCHIVE</a>
            </div>
            <h2><i class="bi bi-list-ul"></i> Block {{ block.block_code }} – {{ block.block_name }}</h2>
            <div class="detail-meta">
                {% if block.start_time %}<span class="pill"><i class="bi bi-clock"></i> Start {{ block.start_time }}</span>{% endif %}
                {% if block.end_time %}<span class="pill"><i class="bi bi-stopwatch"></i> End {{ block.end_time }}</span>{% endif %}
                {% if block.duration_minutes %}<span class="pill"><i class="bi bi-hourglass"></i> {{ block.duration_minutes }} min</span>{% endif %}
                <span class="pill"><i class="bi bi-activity"></i> {{ block.status|upper }}</span>
                {% if block.summary and block.summary.caller_count is not none %}<span class="pill"><i class="bi bi-people"></i> {{ block.summary.caller_count }} callers</span>{% endif %}
            </div>
            {% if block.summary %}
                <h3 class="sub-heading">Summary</h3>
                <div class="summary-text">{{ block.summary.summary_text }}</div>
                {% if block.summary.key_points %}
                    <h3 class="sub-heading">Key Points</h3>
                    <ul style="font-size:.8rem; color:var(--text-secondary); line-height:1.45; margin:0 0 1rem; padding-left:1.1rem;">
                        {% for point in block.summary.key_points %}
                            <li style="margin:.35rem 0;">{{ point }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                {% if block.summary.quotes %}
                    <h3 class="sub-heading">Notable Quotes</h3>
                    {% for quote in block.summary.quotes %}
                        <div class="quote">
                            “{{ quote.text }}”
                            <footer>— {{ quote.speaker }}{% if quote.timestamp %} @ {{ quote.timestamp }}{% endif %}</footer>
                        </div>
                    {% endfor %}
                {% endif %}
                {% if block.summary.entities %}
                    <h3 class="sub-heading">Entities</h3>
                    <div>{% for entity in block.summary.entities %}<span class="entity-badge">{{ entity }}</span>{% endfor %}</div>
                {% endif %}
                {% if block.emergent %}
                    <h3 class="sub-heading" style="margin-top:1.75rem;">Emergent Structure</h3>
                    <!-- Key Themes -->
                    {% if block.emergent.key_themes %}
                        <div style="margin:0 0 .5rem; font-size:.6rem; letter-spacing:.1em; color:var(--text-tertiary);">Detected Key Themes (data-driven, unsupervised)</div>
                        <div class="emergent-grid">
                            {% for theme in block.emergent.key_themes %}
                                <div class="emergent-card">
                                    <div class="theme-title">{{ theme.title }}</div>
                                    {% if theme.summary_bullets %}
                                        <ul class="theme-bullets">
                                            {% for bullet in theme.summary_bullets %}
                                                <li>{{ bullet | replace('•','') | trim }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                    <span class="mini-badge">{{ theme.callers or 0 }} callers</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <!-- Positions -->
                    {% if block.emergent.positions %}
                        <h4 style="margin-top:.25rem; font-size:.65rem; letter-spacing:.15em; color:var(--text-tertiary);">Positions / Stances</h4>
                        <ul class="positions-list">
                            {% for p in block.emergent.positions %}
                                <li><strong>{{ p.actor }}</strong> <span style="opacity:.65;">{{ p.stance }}</span> – {{ p.claim }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    <!-- Actions -->
                    {% if block.emergent.actions %}
                        <h4 style="margin-top:1rem; font-size:.65rem; letter-spacing:.15em; color:var(--text-tertiary);">Actions / Follow-Ups</h4>
                        <ul class="actions-list">
                            {% for a in block.emergent.actions %}
                                <li>{{ a.who }}: {{ a.what }}{% if a.when %} <span style="opacity:.55;">({{ a.when }})</span>{% endif %}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    <div style="margin-top:1rem;">
                        <button class="toggle-raw" onclick="const w=this.parentElement.nextElementSibling;w.style.display=w.style.display==='block'?'none':'block';this.textContent=w.style.display==='block'?'HIDE RAW JSON':'VIEW RAW JSON';">VIEW RAW JSON</button>
                    </div>
                    <div class="raw-json-wrap"><pre class="raw-json">{{ block.emergent | tojson(indent=2) }}</pre></div>
                {% endif %}
            {% endif %}
            {% if block.transcript %}
                <h3 class="sub-heading" style="margin-top:2rem;">Transcript</h3>
                <div style="max-height:600px; overflow:auto; padding-right:.5rem;">
                    {% if block.transcript.segments %}
                        {% for segment in block.transcript.segments %}
                            <div class="transcript-seg">
                                <small>[{{ "%.0f" | format(segment.start) }}s] {{ segment.speaker or 'Speaker' }}</small>
                                {{ segment.text }}
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="transcript-seg">{{ block.transcript.text }}</div>
                    {% endif %}
                </div>
            {% endif %}
        </section>
    </main>
</body>
</html>
